<html>
  <head>
    <title>Mermaid development page</title>
    <style>
      .container {
        display: flex;
        flex-direction: row;
      }

      #code {
        max-width: 30vw;
        width: 30vw;
      }

      #dynamicDiagram {
        padding-left: 2em;
        flex: 1;
      }
    </style>
  </head>
  <body>
    <pre id="diagram" class="mermaid">
      use-case-beta
      actor User
      actor Admin position right
      User --> "Log in"
      User --> "Place orders"      
      User --> "Track Orders"
      Admin --> "Log in"
      Admin --> "Add items"
    </pre>

    <hr />
    Type code to view diagram:
    <div class="container">
      <textarea name="code" id="code" cols="30" rows="10"></textarea>
      <!-- drawing box -->
      <div id="dynamicDiagram"></div> 
    </div>
    <pre class="mermaid">info</pre>

    <!-- <script type="module">
      import mermaid from '/mermaid.esm.mjs';
      import layouts from '/mermaid-layout-elk.esm.mjs';
      mermaid.registerLayoutLoaders(layouts);
    
      //Init first
      mermaid.initialize({
        startOnLoad: true,
        logLevel: 0,
      });
    
      //Render helper (trim)
      async function render(str) {
        const clean = str.trimStart(); //Remove spaces or newlines
        if (!clean) return;
        const { svg } = await mermaid.render('dynamic', clean);
        document.getElementById('dynamicDiagram').innerHTML = svg;
      }
    
      //Restore saved code
      const storeKey = window.location.pathname;
      const saved    = localStorage.getItem(storeKey);
      if (saved) {
        document.getElementById('code').value = saved;
        await render(saved); // now safe: mermaid already init’d
      }
    
      //live‑update on input
      document.getElementById('code').addEventListener('input', async (e) => {
        const value = e.target.value;
        localStorage.setItem(storeKey, value);
        await render(value);
      });
    </script> -->

    <script type="module">
      import mermaid from '/mermaid.esm.mjs';
      import layouts  from '/mermaid-layout-elk.esm.mjs';
      mermaid.registerLayoutLoaders(layouts);
    
      /* 1 –- Mermaid setup */
      mermaid.initialize({ startOnLoad: true, logLevel: 0 });
    
      /* 2 –- Render helper */
      async function render(str) {
        const clean = str.trimStart();
        if (!clean) {
          document.getElementById('dynamicDiagram').innerHTML = '';
          return;
        }
        const { svg } = await mermaid.render('dynamic', clean);
        document.getElementById('dynamicDiagram').innerHTML = svg;
      }
    
      /* 3 –- Always start blank each visit */
      const storeKey = window.location.pathname;
      localStorage.removeItem(storeKey);                 // wipe old stash
      const textarea = document.getElementById('code');  // shortcut
      textarea.value = '';                               // blank editor
    
      /* 4 –- Autosave on every keystroke (no redraw yet) */
      textarea.addEventListener('input', () => {
        localStorage.setItem(storeKey, textarea.value);
      });
    
      /* 5 –- Re-render only after Enter is released  */
      textarea.addEventListener('keyup', async (e) => {
        const plainEnter = e.key === 'Enter' && !e.ctrlKey && !e.shiftKey;
        const ctrlEnter  = e.key === 'Enter' &&  e.ctrlKey;
        if (plainEnter || ctrlEnter) {
          await render(textarea.value);   // newline is already in the value
        }
      });
    </script>
    
    
    

    <script src="/dev/reload.js"></script>
  </body>
</html>
